kind: pipeline
type: docker
name: api
steps:
  - name: build-master
    image: 'node:10.6.0'
    commands:
      - 'npm install'
      - 'npm run build'
    when:
      branch: master
  # - name: public-online   
  #   image: plugins/docker 
  #   volumes:
  #     - /var/run/docker.sock:/var/run/docker.sock 
  #   commands:
  #     - 'docker login --username=hesouli -p Cptbtptp123 registry.cn-beijing.aliyuncs.com'
      # - 'docker build --rm -t docker_test_02 .'
      # - 'docker tag docker_test_02 registry.cn-beijing.aliyuncs.com/my_docker_test_01/docker_test_02'
      # - 'docker push registry.cn-beijing.aliyuncs.com/my_docker_test_01/docker_test_02'
    # when: 
    #   branch: master  
  # rancher-online:
  #   image: peloton/drone-rancher
  #   url: 'https://rancher.11vx.cn'
  #   access_key: B24653F95507063ACE6A
  #   secret_key: seyTtWvHaAUXjuyQBxH5BarRXZcZDaKvb9epCZgM
  #   service: app/app1 
  #   docker_image: 'registry.cn-beijing.aliyuncs.com/my_docker_test_01/docker_test_02'
  #   start_first: false
  #   confirm: true
  #   timeout: 300 
  #   when:
  #     branch: master 